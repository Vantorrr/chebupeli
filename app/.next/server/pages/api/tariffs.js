"use strict";(()=>{var e={};e.id=553,e.ids=[553],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},9011:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>u,default:()=>c,routeModule:()=>l});var s=t(1802),o=t(7153),d=t(6249),i=t(1357),n=e([i]);i=(n.then?(await n)():n)[0];let c=(0,d.l)(i,"default"),u=(0,d.l)(i,"config"),l=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/tariffs",pathname:"/api/tariffs",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},2714:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{z:()=>d});var s=t(9648),o=e([s]);s=(o.then?(await o)():o)[0];class i{constructor(e,r){this.merchantId=e,this.apiKey=r,this.api=s.default.create({baseURL:"https://api.mobimatter.com/mobimatter",headers:{merchantId:e,"api-key":r,"Content-Type":"application/json"}}),this.api.interceptors.request.use(e=>(console.log("MobiMatter API Request:",{method:e.method?.toUpperCase(),url:e.url,baseURL:e.baseURL}),e),e=>(console.error("MobiMatter API Request Error:",e),Promise.reject(e))),this.api.interceptors.response.use(e=>(console.log("MobiMatter API Response:",{status:e.status,url:e.config.url,dataLength:JSON.stringify(e.data).length}),e),e=>(console.error("MobiMatter API Response Error:",{status:e.response?.status,statusText:e.response?.statusText,url:e.config?.url,data:e.response?.data,message:e.message}),Promise.reject(e)))}async getProducts(e){try{let r=await this.api.get("/api/v2/products",{params:e}),t=typeof r.data,a=Array.isArray(r.data),s=r.data&&"object"==typeof r.data&&!Array.isArray(r.data)?Object.keys(r.data):[];if(console.log("MobiMatter getProducts response:",{status:r.status,dataType:t,isArray:a,keys:s.slice(0,10),dataLength:JSON.stringify(r.data).length,firstChars:JSON.stringify(r.data).substring(0,100)}),r.data.result&&Array.isArray(r.data.result))return console.log(`Получено ${r.data.result.length} продуктов (response.data.result)`),r.data.result;if(Array.isArray(r.data))return console.log(`Получено ${r.data.length} продуктов (массив)`),r.data;if(r.data.products&&Array.isArray(r.data.products))return console.log(`Получено ${r.data.products.length} продуктов (response.data.products)`),r.data.products;if(r.data.data&&Array.isArray(r.data.data))return console.log(`Получено ${r.data.data.length} продуктов (response.data.data)`),r.data.data;else return console.warn("Неожиданный формат ответа API:",{type:typeof r.data,isArray:Array.isArray(r.data),keys:r.data&&"object"==typeof r.data?Object.keys(r.data):"N/A",sample:JSON.stringify(r.data).substring(0,200)}),[]}catch(e){throw console.error("MobiMatter API Error (getProducts):",{message:e.message,response:e.response?.data,status:e.response?.status,statusText:e.response?.statusText}),Error(`Failed to fetch products: ${e.response?.data?.message||e.message}`)}}async getProduct(e){try{let r=await this.api.get(`/api/v2/products/${e}`);return r.data.product||r.data.data||r.data}catch(e){throw console.error("MobiMatter API Error (getProduct):",e.response?.data||e.message),Error(`Failed to fetch product: ${e.response?.data?.message||e.message}`)}}async createOrder(e,r){try{let t=await this.api.post("/api/v2/order",{productId:e,label:r?.label||`order_${Date.now()}`,...r}),a=t.data.order||t.data.data||t.data;return{id:a.orderId||a.id,orderId:a.orderId||a.id,productId:a.productId||e,status:a.status||"pending",qrCode:a.qrCode,activationCode:a.activationCode||a.smdpAddress,smdpAddress:a.smdpAddress,iccid:a.iccid,createdAt:a.createdAt||new Date().toISOString()}}catch(e){throw console.error("MobiMatter API Error (createOrder):",e.response?.data||e.message),Error(`Failed to create order: ${e.response?.data?.message||e.message}`)}}async getOrder(e){try{let r=await this.api.get(`/api/v2/order/${e}`),t=r.data.order||r.data.data||r.data;return{id:t.orderId||t.id||e,orderId:t.orderId||t.id||e,productId:t.productId,status:t.status,qrCode:t.qrCode,activationCode:t.activationCode||t.smdpAddress,smdpAddress:t.smdpAddress,iccid:t.iccid,createdAt:t.createdAt}}catch(e){throw console.error("MobiMatter API Error (getOrder):",e.response?.data||e.message),Error(`Failed to fetch order: ${e.response?.data?.message||e.message}`)}}async getOrders(e){try{let r=await this.api.get("/api/v2/orders",{params:e?{userId:e}:{}});if(Array.isArray(r.data))return r.data.map(e=>({id:e.orderId||e.id,orderId:e.orderId||e.id,productId:e.productId,status:e.status,qrCode:e.qrCode,activationCode:e.activationCode||e.smdpAddress,smdpAddress:e.smdpAddress,iccid:e.iccid,createdAt:e.createdAt}));if(r.data.orders&&Array.isArray(r.data.orders))return r.data.orders;if(r.data.data&&Array.isArray(r.data.data))return r.data.data;return[]}catch(e){throw console.error("MobiMatter API Error (getOrders):",e.response?.data||e.message),Error(`Failed to fetch orders: ${e.response?.data?.message||e.message}`)}}async getWalletBalance(){try{return(await this.api.get("/api/v2/wallet/balance")).data}catch(e){throw console.error("MobiMatter API Error (getWalletBalance):",e.response?.data||e.message),Error(`Failed to fetch wallet balance: ${e.response?.data?.message||e.message}`)}}async getCountries(){try{let e=await this.getProducts(),r=new Set;return e.forEach(e=>{e.countries&&Array.isArray(e.countries)&&e.countries.forEach(e=>{r.add(e)})}),Array.from(r).map(e=>({code:e,name:e,region:void 0}))}catch(e){throw console.error("Не удалось получить страны из продуктов:",e),e}}}let n=null;function d(){if(!n){let e=process.env.MOBIMATTER_MERCHANT_ID,r=process.env.MOBIMATTER_API_KEY;if(!e||!r)throw Error("MobiMatter credentials not configured. Please set MOBIMATTER_MERCHANT_ID and MOBIMATTER_API_KEY environment variables.");n=new i(e,r)}return n}a()}catch(e){a(e)}})},1357:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>d});var s=t(2714),o=e([s]);s=(o.then?(await o)():o)[0];let i={TH:"Таиланд",NL:"Нидерланды",TR:"Турция",AE:"ОАЭ",EG:"Египет",ES:"Испания",IT:"Италия",GR:"Греция",JP:"Япония",SG:"Сингапур",MV:"Мальдивы",MA:"Марокко",US:"США",GB:"Великобритания",FR:"Франция",DE:"Германия",CN:"Китай",IN:"Индия",BR:"Бразилия",AU:"Австралия",ID:"Индонезия",MY:"Малайзия",PH:"Филиппины",VN:"Вьетнам",KR:"Южная Корея",PT:"Португалия",PL:"Польша",CZ:"Чехия",AT:"Австрия",CH:"Швейцария",GH:"Гана",VE:"Венесуэла",GL:"Гренландия"};async function d(e,r){if("GET"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let t=e.query.country,a=[];try{let e=(0,s.z)(),r=await e.getProducts();console.log(`Получено ${r.length} продуктов из MobiMatter API`);let o=parseFloat(process.env.TARIFF_MARGIN||"1.0");(a=r.filter(e=>{let r="esim_realtime"===e.productCategory,a="0"!==e.EXTERNALLY_SHOWN,s=!t||e.countries&&Array.isArray(e.countries)&&e.countries.includes(t);return r&&a&&s}).map(e=>{let r=e.wholesalePrice||0,a={};e.productDetails&&Array.isArray(e.productDetails)&&e.productDetails.forEach(e=>{e.name&&void 0!==e.value&&(a[e.name]=e.value)});let s=a.PLAN_TITLE||"",d=a.PLAN_DATA_LIMIT?parseFloat(a.PLAN_DATA_LIMIT):0,n=a.PLAN_VALIDITY?parseFloat(a.PLAN_VALIDITY):0,c="1"===a.UNLIMITED||s.toLowerCase().includes("unlimited"),u=e.countries&&e.countries.length>0?e.countries[0]:t||"",l=i[u]||u;return{id:e.productId||e.uniqueId||e.id,country:l,countryCode:u,dataGB:d||1,days:n>0?Math.round(n/24):7,type:c?"Unlimited":"Standard",price:Math.round(r*(1+o)*100)/100,originalPrice:r,region:e.regions&&e.regions.length>0?e.regions[0]:void 0,providerName:e.providerName||"MobiMatter",providerLogo:e.providerLogo||"SIM",networkType:a.NETWORKS_SHORT||"4G"}})).sort((e,r)=>e.price-r.price),console.log(`Сформировано ${a.length} тарифов для страны ${t||"все"}`)}catch(r){console.warn("MobiMatter API недоступен, используем моковые данные:",r.message),a=({TR:[{id:"1",country:"Турция",countryCode:"TR",dataGB:5,days:30,type:"Standard",price:990,originalPrice:495,region:"Европа"},{id:"2",country:"Турция",countryCode:"TR",dataGB:10,days:30,type:"Unlimited",price:1990,originalPrice:995,region:"Европа"},{id:"3",country:"Турция",countryCode:"TR",dataGB:3,days:15,type:"Standard",price:590,originalPrice:295,region:"Европа"}],AE:[{id:"4",country:"ОАЭ",countryCode:"AE",dataGB:10,days:30,type:"Unlimited",price:1990,originalPrice:995,region:"Ближний Восток"},{id:"5",country:"ОАЭ",countryCode:"AE",dataGB:5,days:30,type:"Standard",price:990,originalPrice:495,region:"Ближний Восток"}],TH:[{id:"6",country:"Таиланд",countryCode:"TH",dataGB:8,days:15,type:"Standard",price:1490,originalPrice:745,region:"Азия"},{id:"7",country:"Таиланд",countryCode:"TH",dataGB:15,days:30,type:"Unlimited",price:2490,originalPrice:1245,region:"Азия"}]})[t]||[];let e=parseFloat(process.env.TARIFF_MARGIN||"1.0");a=a.map(r=>({...r,price:Math.round(r.originalPrice*(1+e))}))}r.status(200).json({tariffs:a})}catch(e){console.error("Ошибка загрузки тарифов:",e),r.status(500).json({error:"Ошибка загрузки тарифов",details:e.message})}}a()}catch(e){a(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=9011);module.exports=t})();